apiVersion: v1
kind: ConfigMap
metadata:
  name: alert-template
  namespace: alertmanager-ns
data:
  email.tmpl: |-
    {{ define "email.default.html" }}
    <!DOCTYPE html>
    <html>
    <head>
      <meta charset="UTF-8">
      <style>
        body {
          font-family: "Microsoft YaHei", Arial, sans-serif;
          background-color: #f6f8fa;
          padding: 20px;
          color: #333;
        }

        h2 {
          text-align: center;
          color: #333;
          margin-bottom: 20px;
        }

        .alert-box {
          border: 1px solid #ddd;
          border-left: 6px solid #2196F3;
          border-radius: 8px;
          background-color: #fff;
          padding: 15px 20px;
          margin-bottom: 15px;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .critical {
          border-left-color: #d93025;
          background-color: #fdecea;
        }

        .warning {
          border-left-color: #f9a825;
          background-color: #fff8e1;
        }

        .resolved {
          border-left-color: #2e7d32;
          background-color: #e8f5e9;
        }

        .label {
          font-weight: bold;
          color: #555;
        }

        .footer {
          text-align: center;
          color: #999;
          margin-top: 20px;
          font-size: 13px;
        }
      </style>
    </head>

    <body>
      <h2>ğŸ”¥ Prometheus å‘Šè­¦é€šçŸ¥ ğŸ””</h2>

      <!-- è§¦å‘ä¸­çš„å‘Šè­¦ -->
      {{- if gt (len .Alerts.Firing) 0 }}
        {{- range .Alerts }}
          <div class="alert-box {{ .Labels.severity }}">
            <p><span class="label">çŠ¶æ€ï¼š</span>
              <b style="color:#d93025;">è§¦å‘ä¸­ (Firing)</b>
            </p>
            <p><span class="label">å‘Šè­¦ç¨‹åºï¼š</span> prometheus_alert</p>
            <p><span class="label">å‘Šè­¦çº§åˆ«ï¼š</span> {{ .Labels.severity }}</p>
            <p><span class="label">å‘Šè­¦ç±»å‹ï¼š</span> {{ .Labels.alertname }}</p>
            <p><span class="label">å‘Šè­¦ä¸»æœºï¼š</span> {{ .Labels.instance }}</p>
            <p><span class="label">å‘Šè­¦ä¸»é¢˜ï¼š</span> {{ .Annotations.summary }}</p>
            <p><span class="label">å‘Šè­¦è¯¦æƒ…ï¼š</span> {{ .Annotations.description }}</p>
            <p><span class="label">è§¦å‘æ—¶é—´ï¼š</span>
              {{ .StartsAt.Format "2006-01-02 15:04:05" }}
            </p>
          </div>
        {{- end }}
      {{- end }}

      <!-- æ¢å¤çš„å‘Šè­¦ -->
      {{- if gt (len .Alerts.Resolved) 0 }}
        {{- range .Alerts }}
          <div class="alert-box resolved">
            <p><span class="label">çŠ¶æ€ï¼š</span>
              <b style="color:#2e7d32;">å·²æ¢å¤ (Resolved)</b>
            </p>
            <p><span class="label">å‘Šè­¦ç¨‹åºï¼š</span> prometheus_alert</p>
            <p><span class="label">å‘Šè­¦çº§åˆ«ï¼š</span> {{ index .Labels "severity" }}</p>
            <p><span class="label">å‘Šè­¦ç±»å‹ï¼š</span> {{ .Labels.alertname }}</p>
            <p><span class="label">å‘Šè­¦ä¸»æœºï¼š</span> {{ .Labels.instance }}</p>
            <p><span class="label">å‘Šè­¦ä¸»é¢˜ï¼š</span> {{ .Annotations.summary }}</p>
            <p><span class="label">å‘Šè­¦è¯¦æƒ…ï¼š</span> {{ .Annotations.description }}</p>
            <p><span class="label">è§¦å‘æ—¶é—´ï¼š</span>
              {{ .StartsAt.Format "2006-01-02 15:04:05" }}
            </p>
            <p><span class="label">æ¢å¤æ—¶é—´ï¼š</span>
              {{ .EndsAt.Format "2006-01-02 15:04:05" }}
            </p>
          </div>
        {{- end }}
      {{- end }}

      <div class="footer">
        æœ¬é‚®ä»¶ç”± <b>Alertmanager</b> è‡ªåŠ¨å‘é€ï¼Œè¯·å‹¿ç›´æ¥å›å¤ã€‚<br>
        è‹¥éœ€å–æ¶ˆæˆ–ä¿®æ”¹é€šçŸ¥ï¼Œè¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜ã€‚
      </div>
    </body>
    </html>
    {{ end }}