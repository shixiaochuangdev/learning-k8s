apiVersion: v1
kind: ConfigMap
metadata:
  name: wechat-tmpl
  namespace: alertmanager-ns
data:
  wechat.tmpl: |
    {{ define "wechat.default.message" }}

    {{/* ---------- ğŸš¨ å‘Šè­¦è§¦å‘ ---------- */}}
    {{- if gt (len .Alerts.Firing) 0 -}}

    ğŸš¨ã€Prometheus å‘Šè­¦é€šçŸ¥ã€‘ğŸš¨
    å…±æœ‰ {{ len .Alerts.Firing }} æ¡å‘Šè­¦æ­£åœ¨è§¦å‘ï¼

    {{- range $alert := .Alerts.Firing }}
    ------------------------------
    ğŸ”¥ å‘Šè­¦ï¼š
    å‘Šè­¦åç§°ï¼š{{ $alert.Labels.alertname }}
    å‘Šè­¦çº§åˆ«ï¼š{{ $alert.Labels.severity }}
    å®ä¾‹ä¿¡æ¯ï¼š{{ $alert.Labels.instance }}
    ä¸»é¢˜ä¿¡æ¯ï¼š{{ $alert.Annotations.summary }}
    å‘Šè­¦è¯¦æƒ…ï¼š{{ $alert.Annotations.message }}{{ $alert.Annotations.description }}
    è§¦å‘æ—¶é—´ï¼š{{ ($alert.StartsAt.Add 28800e9).Format "2006-01-02 15:04:05" }}
    ------------------------------
    {{- end }}

    ğŸ“… å½“å‰çŠ¶æ€ï¼šFIRING

    {{- end }}

    {{/* ---------- âœ… å‘Šè­¦æ¢å¤ ---------- */}}
    {{- if gt (len .Alerts.Resolved) 0 -}}

    âœ…ã€Prometheus å‘Šè­¦æ¢å¤ã€‘âœ…
    å…±æœ‰ {{ len .Alerts.Resolved }} æ¡å‘Šè­¦å·²æ¢å¤ã€‚

    {{- range $alert := .Alerts.Resolved }}
    ------------------------------
    ğŸ’š æ¢å¤å‘Šè­¦ï¼š
    å‘Šè­¦åç§°ï¼š{{ $alert.Labels.alertname }}
    å®ä¾‹ä¿¡æ¯ï¼š{{ $alert.Labels.instance }}
    ä¸»é¢˜ä¿¡æ¯ï¼š{{ $alert.Annotations.summary }}
    æ•…éšœæ—¶é—´ï¼š{{ ($alert.StartsAt.Add 28800e9).Format "2006-01-02 15:04:05" }}
    æ¢å¤æ—¶é—´ï¼š{{ ($alert.EndsAt.Add 28800e9).Format "2006-01-02 15:04:05" }}
    ------------------------------
    {{- end }}

    {{- end }}

    {{- end }}